<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RENUOVA - Official Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<!-- FontAwesome & Google Fonts -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<style>
/* ===== PREMIUM LOADING PAGE ===== */
#loader {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100vh;
    background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);
    font-family: 'Inter', sans-serif;
}
.particles {
    position: absolute;
    width: 100%; height: 100%;
    background-image: radial-gradient(#ffffff 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.1;
    animation: moveBg 20s linear infinite;
}
@keyframes moveBg { from { background-position: 0 0; } to { background-position: 500px 500px; } }
.brand-name { display: flex; gap: 5px; letter-spacing: 15px; animation: squeeze 1.5s ease-out forwards; }
.letter {
    font-size: 3.5rem; font-weight: 900; color: #fff; text-transform: uppercase; display: inline-block;
    opacity: 0; filter: blur(10px); animation: reveal 0.8s cubic-bezier(0.17, 0.67, 0.83, 0.67) forwards;
    text-shadow: 0 0 30px rgba(56, 189, 248, 0.8);
}
.letter:nth-child(1) { animation-delay: 0.1s; color: #38bdf8; }
.letter:nth-child(2) { animation-delay: 0.2s; }
.letter:nth-child(3) { animation-delay: 0.3s; }
.letter:nth-child(4) { animation-delay: 0.4s; }
.letter:nth-child(5) { animation-delay: 0.5s; }
.letter:nth-child(6) { animation-delay: 0.6s; }
.letter:nth-child(7) { animation-delay: 0.7s; color: #38bdf8; }

.loader-line-container { width: 250px; height: 2px; background: rgba(255, 255, 255, 0.05); margin-top: 40px; position: relative; overflow: hidden; }
.loader-line { position: absolute; height: 100%; width: 40%; background: linear-gradient(90deg, transparent, #38bdf8, transparent); animation: lineMove 1.5s infinite ease-in-out; }
@keyframes reveal { to { opacity: 1; filter: blur(0); transform: translateY(0); } }
@keyframes squeeze { to { letter-spacing: 5px; } }
@keyframes lineMove { 0% { left: -100%; } 100% { left: 100%; } }

/* ===== UI CSS ===== */
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:#f1f3f6; color:#333; overflow-x: hidden; padding-bottom: 70px;}
header{background:#2874f0;color:#fff;padding:14px;display:flex; justify-content: space-between; align-items: center; font-size:20px;font-weight:700; position: sticky; top:0; z-index: 1000; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}

/* CATEGORY BAR */
.cat-container { display: flex; overflow-x: auto; background: #fff; padding: 10px; gap: 12px; border-bottom: 1px solid #ddd; scrollbar-width: none; }
.cat-container::-webkit-scrollbar { display: none; }
.cat-card { min-width: 75px; text-align: center; cursor: pointer; }
.cat-card i { display: block; font-size: 22px; color: #2874f0; margin-bottom: 4px; }
.cat-card span { font-size: 11px; font-weight: 600; color: #444; }

.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:12px;}
.card{background:#fff;border-radius:10px;padding:8px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.1);transition:.2s; position: relative;}
.card:active{transform:scale(.97)}
.card img{width:100%;height:160px;object-fit:contain;border-radius:8px;}
.card h3{margin:6px 0 2px;font-size:14px;font-weight:600; color:#333; height: 36px; overflow: hidden;}
.card p{margin:0;color:#388e3c;font-weight:700;}

/* WISHLIST HEART & SHARE */
.wish-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.8); width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #ccc; transition: 0.3s; z-index: 10; }
.wish-btn.active { color: #ff3f6c; }
.share-icon-btn { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #2874f0; transition: 0.3s; z-index: 10; border: none; font-size: 14px; }

/* SUCCESS SCREEN OVERLAY */
#successOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #27ae60; z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
.success-icon { font-size: 100px; margin-bottom: 20px; animation: pop 0.5s ease; }
@keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1.2); } }

/* BOTTOM NAVIGATION */
.bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 10px 0; z-index: 1001; }
.nav-item { text-align: center; color: #717478; font-size: 10px; flex: 1; cursor: pointer; }
.nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }
.nav-item.active { color: #2874f0; }

.page{display:none;padding:12px; animation: fadeIn 0.3s;}
@keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

/* POSTER SLIDER */
.home-poster-container { padding: 10px; display: block; }
.poster-slider { width: 100%; height: 180px; background: #ddd; border-radius: 10px; overflow: hidden; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
@media (min-width: 600px) { .poster-slider { height: 280px; } }
.poster-slider img { width: 100%; height: 100%; object-fit: cover; }

/* PRODUCT DETAILS SLIDER */
.slider{position:relative;background:#fff;padding:10px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1); text-align: center;}
.slider img{width:100%;height:280px;object-fit:contain;border-radius:10px;}
.arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.8);color:#000;padding:8px 12px;border-radius:50%;cursor:pointer;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,.3); z-index: 5;}
.left{left:8px}.right{right:8px}

/* THUMBNAIL BAR */
.thumb-bar { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
.thumb-bar::-webkit-scrollbar { display: none; }
.thumb-img { width: 60px; height: 60px; object-fit: contain; border: 2px solid #ddd; border-radius: 5px; flex-shrink: 0; cursor: pointer; }
.thumb-img.active { border-color: #2874f0; }

/* BUTTONS */
.btn{background:#fb641b;color:#fff;padding:14px;text-align:center;border-radius:8px;margin-top:12px;text-decoration:none;display:block;font-weight:700; border:none; width:100%; cursor:pointer; font-size: 16px;}
.btn.dark{background:#2874f0}
.btn.cart-btn{background:#ff9f00; margin-bottom: 5px;}
.back-btn { width: auto !important; display: inline-block !important; padding: 8px 18px !important; font-size: 14px !important; margin-bottom: 10px !important; }

input,textarea,select{width:100%;padding:12px;margin:6px 0;border-radius:6px;border:1px solid #ccc; box-sizing: border-box; font-size: 14px;}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:10px; font-size: 11px;}
th,td{border:1px solid #ddd;padding:6px;text-align:center;}

/* PAGES */
#authPage, #cartPage, #myOrdersPage, #wishlistPage, #categoryPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f1f3f6; z-index: 2500; display: none; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
.badge { background: #ff3f6c; color: white; border-radius: 50%; padding: 2px 6px; font-size: 11px; vertical-align: middle; margin-left: 3px; border: 1px solid #fff; }

/* CHAT CSS */
#supportChatPage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 2000; display: none; flex-direction: column; }
.chat-header { background: #2874f0; color: #fff; padding: 15px; display: flex; align-items: center; gap: 10px; font-weight: bold; }
#chatMessages { flex: 1; overflow-y: auto; padding: 15px; background: #f9f9f9; display: flex; flex-direction: column; gap: 10px; }
.msg { max-width: 80%; padding: 10px; border-radius: 10px; font-size: 14px; }
.msg.user { align-self: flex-end; background: #2874f0; color: #fff; border-bottom-right-radius: 2px; }
.msg.admin { align-self: flex-start; background: #e0e0e0; color: #333; border-bottom-left-radius: 2px; }
.chat-input-box { padding: 10px; border-top: 1px solid #ddd; display: flex; gap: 8px; background:#fff;}
.chat-input-box input { margin: 0; flex: 1; }

/* TRACKING UI STYLES */
.tracking-container { background: #fff; padding: 20px; border-radius: 12px; margin-top: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.tracking-item { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 25px; position: relative; }
.tracking-item:not(:last-child):after { content: ''; position: absolute; left: 11px; top: 25px; width: 2px; height: 35px; background: #ddd; }
.tracking-item.active:after { background: #388e3c; }
.track-icon { width: 24px; height: 24px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; z-index: 1; }
.tracking-item.active .track-icon { background: #388e3c; }
.track-info b { font-size: 14px; color: #333; display: block; }
.track-info span { font-size: 11px; color: #888; }

/* CANCELLED TRACKING STYLES */
.tracking-item.is-cancelled .track-icon { background: #e63946 !important; }
.tracking-item.is-cancelled:after { background: #e63946 !important; }
.tracking-item.is-cancelled b { color: #e63946; }

.total-box { background: #fff; padding: 15px; border-radius: 10px; margin-top: 15px; display: flex; flex-direction: column; gap: 5px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); border: 1px solid #ddd; }
.total-box div { display: flex; justify-content: space-between; align-items: center; }
.total-price { font-size: 20px; color: #388e3c; font-weight: 900; }

.admin-chat-card { background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
.btn-delete-chat { background: #d32f2f; color: #fff; border: none; padding: 8px; border-radius: 4px; cursor: pointer; }
.policy-badge { background: #e3f2fd; color: #1976d2; padding: 5px 10px; border-radius: 4px; font-size: 12px; display: inline-block; margin-top: 10px; font-weight: 600; }

/* ===== NAYA NOTIFICATION POPUP CSS ===== */
#broadcastOverlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); z-index: 9999;
    display: none; align-items: center; justify-content: center;
    padding: 20px; box-sizing: border-box;
    font-family: 'Inter', sans-serif;
}
.broadcast-card {
    background: #fff; width: 100%; max-width: 380px;
    border-radius: 20px; overflow: hidden;
    animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    text-align: center;
}
@keyframes bounceIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.broadcast-card img { width: 100%; height: 210px; object-fit: cover; display: block; background: #f0f0f0; }
.broadcast-content { padding: 25px; }
.broadcast-content h3 { margin: 0 0 10px; color: #2874f0; font-weight: 900; font-size: 22px; }
.broadcast-content p { font-size: 15px; color: #444; line-height: 1.6; margin-bottom: 25px; }
.close-broadcast-btn { background: #2874f0; color: #fff; border: none; padding: 12px 0; border-radius: 30px; cursor: pointer; font-weight: 700; width: 100%; font-size: 16px; transition: 0.3s; }
.close-broadcast-btn:active { transform: scale(0.95); }
</style>
</head>

<body>

<!-- NOTIFICATION OVERLAY -->
<div id="broadcastOverlay">
    <div class="broadcast-card">
        <img id="brImg" src="">
        <div class="broadcast-content">
            <h3 id="brTitle">RENUOVA Update</h3>
            <p id="brMsg"></p>
            <button class="close-broadcast-btn" onclick="closeBroadcast()">✕ Close Notification</button>
        </div>
    </div>
</div>

<!-- LOADING SCREEN -->
<div id="loader">
    <div class="particles"></div>
    <div class="brand-name">
        <span class="letter">R</span><span class="letter">E</span><span class="letter">N</span><span class="letter">U</span><span class="letter">O</span><span class="letter">V</span><span class="letter">A</span>
    </div>
    <div class="loader-line-container"><div class="loader-line"></div></div>
</div>

<!-- SUCCESS SCREEN -->
<div id="successOverlay">
    <i class="fa fa-check-circle success-icon"></i>
    <h1>Order Successful!</h1>
    <p>Your order has been recorded.</p>
</div>

<div id="mainSite" style="display:none; opacity: 0; transition: opacity 1s ease;">

<header>
    <div onclick="openSupport()" style="font-size: 13px; font-weight: normal; cursor: pointer;"><i class="fa fa-headset"></i> Support</div>
    <div id="logo" onclick="goHome()" style="cursor: pointer; letter-spacing: 2px;">RENUOVA</div>
    <div style="display: flex; gap: 12px; align-items: center; font-size: 16px;">
        <div onclick="openCart()" style="cursor: pointer; position:relative;"><i class="fa fa-shopping-cart"></i><span id="cartCount" class="badge">0</span></div>
    </div>
</header>

<!-- HOME SECTION -->
<div id="homeSection">
    <!-- CATEGORY BAR -->
    <div class="cat-container">
        <div class="cat-card" onclick="filterCat('Electronic')"><i class="fa fa-plug"></i><span>Electronic</span></div>
        <div class="cat-card" onclick="filterCat('Beauty')"><i class="fa fa-magic"></i><span>Beauty</span></div>
        <div class="cat-card" onclick="filterCat('Sarees')"><i class="fa fa-female"></i><span>Sarees</span></div>
        <div class="cat-card" onclick="filterCat('Clothes')"><i class="fa fa-tshirt"></i><span>Clothes</span></div>
        <div class="cat-card" onclick="filterCat('Gadgets')"><i class="fa fa-mobile-alt"></i><span>Gadgets</span></div>
        <div class="cat-card" onclick="filterCat('Kitchen')"><i class="fa fa-utensils"></i><span>Kitchen</span></div>
    </div>

    <div style="padding:10px;background:#f1f3f6;">
      <input id="searchBox" type="search" placeholder="Search products..." onkeyup="searchProduct(event)">
    </div>
    <div class="home-poster-container">
        <div class="poster-slider">
            <img id="homePosterImg" src="https://via.placeholder.com/600x200?text=Mega+Sale+Offer">
        </div>
    </div>
    <div id="home" class="grid">Loading products...</div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
    <div class="nav-item active" onclick="goHome(this)"><i class="fa fa-home"></i>Home</div>
    <div class="nav-item" onclick="openWishlist(this)"><i class="fa fa-heart"></i>Wishlist</div>
    <div class="nav-item" onclick="openMyOrders(this)"><i class="fa fa-box"></i>Orders</div>
    <div class="nav-item" onclick="openSupport()"><i class="fa fa-comment-alt"></i>Chat</div>
    <div class="nav-item" onclick="openAuth(this)"><i class="fa fa-user"></i>Account</div>
</div>

<!-- CATEGORY FILTER PAGE -->
<div id="categoryPage">
    <button class="btn dark back-btn" onclick="goHome()">⬅ Back</button>
    <h2 id="catTitle">Category</h2>
    <div id="catGrid" class="grid"></div>
</div>

<!-- WISHLIST PAGE -->
<div id="wishlistPage">
    <button class="btn dark back-btn" onclick="goHome()">⬅ Back</button>
    <h2>My Wishlist</h2>
    <div id="wishlistGrid" class="grid"></div>
</div>

<!-- AUTH PAGE -->
<div id="authPage">
    <button class="btn dark back-btn" onclick="goHome()">✕ Close</button>
    <div id="authContent" style="max-width: 400px; margin: auto; padding-top: 20px;">
        <div id="loginSection">
            <h2 style="text-align:center;">Member Login</h2>
            <input type="text" id="authName" placeholder="Enter Full Name (New Users)">
            <input type="email" id="authEmail" placeholder="Enter Valid Email">
            <input type="password" id="authPass" placeholder="Enter Password">
            <button class="btn" id="authSubmitBtn" onclick="handleAuth()">Login / Create Account</button>
            <p style="font-size: 11px; color: #e63946; margin-top: 10px; text-align: center; display:none;" id="authError"></p>
        </div>
        <div id="profileSection" style="display:none; text-align: center;">
            <div style="font-size: 60px; color: #2874f0; margin-bottom: 10px;"><i class="fa fa-user-circle"></i></div>
            <h2 id="profNameDisplay">User Name</h2>
            <p id="profEmailDisplay" style="color:#666;"></p>
            <button class="btn dark" onclick="logout()">Sign Out</button>
        </div>
    </div>
</div>

<!-- MY ORDERS PAGE -->
<div id="myOrdersPage">
    <button class="btn dark back-btn" onclick="goHome()">⬅ Back</button>
    <h2 style="border-bottom: 2px solid #2874f0; padding-bottom: 10px;">My Orders</h2>
    <div id="myOrdersList"></div>
    <div id="orderTrackingDetail" style="display:none; margin-top:20px;">
        <button class="btn dark back-btn" onclick="hideTracking()">⬅ Back to List</button>
        <h3 id="trackOrderName">Order Tracking</h3>
        <p id="trackOrderIdDisplay" style="color:#666; font-size:12px;"></p>
        <div id="trackingUI" class="tracking-container"></div>
        <!-- CANCEL BUTTON WILL BE RENDERED HERE INSIDE DETAILS -->
        <div id="cancelOrderSection"></div>
    </div>
</div>

<!-- CART PAGE -->
<div id="cartPage">
    <button class="btn dark back-btn" onclick="goHome()">⬅ Back</button>
    <h2>My Cart</h2>
    <div id="cartItemsList"></div>
    <div id="cartEmptyMsg" style="text-align:center; padding:50px 20px; display:none;">
        <i class="fa fa-shopping-basket" style="font-size: 50px; color: #ccc;"></i>
        <p>Your cart is empty!</p>
    </div>
    <div id="cartFooter" style="display:none;">
        <div class="total-box">
            <div><span>Items Price:</span> <b id="totalItemCost">₹0</b></div>
            <div><span>Delivery Cost:</span> <b id="totalDeliveryCost">₹0</b></div>
            <hr>
            <div><b>Grand Total:</b> <span id="cartTotalPrice" class="total-price">₹0</span></div>
        </div>
        <button class="btn" onclick="checkoutFromCart()">Proceed to Checkout</button>
    </div>
</div>

<!-- SUPPORT CHAT -->
<div id="supportChatPage">
    <div class="chat-header"><i class="fa fa-arrow-left" onclick="closeSupport()"></i><span>Support Center</span></div>
    <div id="chatMessages"></div>
    <div class="chat-input-box">
        <input type="text" id="userChatInput" placeholder="Describe your issue...">
        <button class="btn dark" style="margin:0; width:auto;" onclick="sendUserMsg()">Send</button>
    </div>
</div>

<!-- PRODUCT DETAILS PAGE -->
<div id="product" class="page">
    <button class="btn dark back-btn" onclick="goHome()">⬅ Back to Store</button>
    <div class="slider">
        <img id="slideImg">
        <div class="arrow left" onclick="prevImg()">‹</div>
        <div class="arrow right" onclick="nextImg()">›</div>
    </div>
    <!-- THUMBNAIL BAR -->
    <div id="pThumbBar" class="thumb-bar"></div>
    
    <h2 id="pname" style="margin: 15px 0 5px;"></h2>
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 id="pprice" style="color: #388e3c; margin: 0;"></h3>
        <span id="pdelcost" style="font-size: 13px; color: #666;"></span>
    </div>
    <div id="preturn" class="policy-badge"></div>
    <p id="pdetails" style="line-height: 1.5; color: #555; margin-top:15px;"></p>
    <div style="background: #fff9e6; padding: 10px; border-radius: 6px; margin: 15px 0;">
        <b>Warranty:</b> <span id="pwarranty"></span>
    </div>
    <button class="btn" style="background: #25D366; margin-bottom: 10px;" onclick="shareProduct()"><i class="fa fa-share-alt"></i> Share Product</button>
    <button class="btn cart-btn" onclick="addToCart()">Add to Cart</button>
    <button class="btn" onclick="triggerBuyNow()">Buy Now</button>
</div>

<!-- CHECKOUT / ORDER PAGE -->
<div id="checkoutPage" class="page" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:3000; overflow-y:auto; padding:20px; box-sizing:border-box;">
    <button class="btn dark back-btn" onclick="closeCheckout()">⬅ Back</button>
    <h2>Complete Your Order</h2>
    <div id="orderSummary" style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom: 20px; border: 1px dashed #2874f0;"></div>
    <label>Recipient's Name:</label><input type="text" id="custName" placeholder="Full Name">
    <label>Mobile Number:</label><input type="number" id="custPhone" placeholder="Mobile Number">
    <label>State:</label><input type="text" id="custState" placeholder="State">
    <label>District:</label><input type="text" id="custDistrict" placeholder="District">
    <label>Pincode:</label><input type="number" id="custPin" placeholder="6-digit Pincode">
    <label>Full Address:</label><textarea id="custFullAddress" placeholder="Building, Street, Landmark..." rows="3"></textarea>
    <button class="btn" onclick="confirmOrder()">Confirm Order</button>
</div>

<!-- ADMIN DASHBOARD -->
<div id="adminList" class="page">
    <h2 style="color: #d32f2f;">Admin Dashboard</h2>
    
    <!-- SOCIAL BROADCAST BOX -->
    <div style="background: #e3f2fd; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #2874f0;">
        <h4 style="margin: 0 0 10px; color: #1976d2;"><i class="fa fa-bullhorn"></i> Global Notification</h4>
        <input type="text" id="bcTitle" placeholder="Notification Title (e.g. New Offer!)">
        <input type="text" id="bcMsg" placeholder="Notification message text...">
        <input type="text" id="bcImg" placeholder="Image Link (Link to photo)...">
        <button class="btn dark" onclick="sendBroadcast()" style="padding:10px; margin-top:5px;">Send to All Users</button>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
        <button class="btn dark" onclick="goHome()">View Website</button>
        <button class="btn" onclick="addNew()">+ New Product</button>
        <button class="btn dark" onclick="showOrders()">View Orders</button>
        <button class="btn dark" onclick="showAdminSupport()">Support Chats</button>
        <button class="btn" style="background: #6200ea;" onclick="showCustomerDetails()">User Logins</button>
    </div>
    <table style="margin-top: 20px;">
        <thead><tr style="background:#eee;"><th>Product Name</th><th>Price</th><th>Action</th></tr></thead>
        <tbody id="plist"></tbody>
    </table>
</div>

<!-- ADMIN SECTIONS -->
<div id="adminOrders" class="page">
    <h2>Manage Orders</h2>
    <button class="btn dark back-btn" onclick="openAdminList()">⬅ Back</button>
    <div style="overflow-x:auto;">
        <table>
            <thead><tr style="background:#2874f0; color:#fff;"><th>Date</th><th>Customer</th><th>Total</th><th>Status</th><th>Edit</th><th>Del</th></tr></thead>
            <tbody id="orderTableBody"></tbody>
        </table>
    </div>
</div>
<div id="adminEditOrderStatus" class="page" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:3000; padding:20px; box-sizing:border-box; overflow-y:auto;">
    <button class="btn dark back-btn" onclick="showOrders()">⬅ Back</button>
    <h3 id="adminEditOrderTitle">Edit Order</h3>
    <!-- FULL ADDRESS DETAILS CONTAINER -->
    <div id="adminOrderFullDetails" style="background:#f4f4f4; padding:15px; margin-bottom:15px; border-radius:8px; font-size:13px; line-height:1.6; border:1px solid #ddd;"></div>
    
    <label>Status:</label>
    <select id="adminStatusSelector">
        <option value="Confirmed">Confirmed</option>
        <option value="Packed">Packed</option>
        <option value="Shipped">Shipped</option>
        <option value="Out for Delivery">Out for Delivery</option>
        <option value="Delivered">Delivered</option>
        <option value="Cancelled">Cancelled</option>
    </select>
    <label>Date Confirmed:</label><input type="text" id="dateConfirmed">
    <label>Date Packed:</label><input type="text" id="datePacked">
    <label>Date Shipped:</label><input type="text" id="dateShipped">
    <label>Date Out:</label><input type="text" id="dateOut">
    <label>Date Delivered:</label><input type="text" id="dateDelivered">
    <button class="btn" onclick="updateOrderStatus()">Update Order</button>
</div>
<div id="adminLoginDetails" class="page">
    <h2>Login History</h2>
    <button class="btn dark back-btn" onclick="openAdminList()">⬅ Back</button>
    <div style="overflow-x:auto;">
        <table>
            <thead><tr style="background:#2874f0; color:#fff;"><th>Name</th><th>Email</th><th>Pass</th><th>Del</th></tr></thead>
            <tbody id="loginTableBody"></tbody>
        </table>
    </div>
</div>
<div id="adminSupportList" class="page">
    <h2>Support Inbox</h2>
    <button class="btn dark back-btn" onclick="openAdminList()">⬅ Back</button>
    <div id="chatListContainer"></div>
</div>
<div id="adminReplyPage" class="page">
    <button class="btn dark back-btn" onclick="showAdminSupport()">⬅ Back</button>
    <div id="adminChatMessages" style="height: 400px; overflow-y: auto; background: #eee; padding: 15px; display: flex; flex-direction: column; gap: 10px;"></div>
    <div class="chat-input-box">
        <input type="text" id="adminReplyInput" placeholder="Reply...">
        <button class="btn" style="margin:0; width: auto;" onclick="sendAdminReply()">Reply</button>
    </div>
</div>
<div id="adminEdit" class="page">
    <h2 id="formTitle">Editor</h2>
    <button class="btn dark back-btn" onclick="openAdminList()">⬅ Cancel</button>
    <label>Category</label>
    <select id="acat">
        <option value="Electronic">Electronic</option>
        <option value="Beauty">Beauty</option>
        <option value="Sarees">Sarees</option>
        <option value="Clothes">Clothes</option>
        <option value="Gadgets">Gadgets</option>
        <option value="Kitchen">Kitchen</option>
    </select>
    <label>Name</label><input id="aname">
    <label>Price</label><input id="aprice">
    <label>Delivery</label><input id="adelcost">
    <label>Return</label><input id="areturn">
    <label>Images</label><input id="img1"><input id="img2"><input id="img3">
    <label>Details</label><textarea id="adetails" rows="4"></textarea>
    <label>Warranty</label><input id="awarranty">
    <button class="btn" onclick="save()">Save</button>
</div>

</div>

<script>
/* FIREBASE CONFIGURATION */
const firebaseConfig={
 apiKey:"AIzaSyBzfvl9ZcvApNZf7kFih7oCvGkYLSAKm0",
 authDomain:"nuova-87735.firebaseapp.com",
 databaseURL:"https://nuova-87735-default-rtdb.firebaseio.com",
 projectId:"nuova-87735",
 storageBucket:"nuova-87735.firebasestorage.app",
 messagingSenderId:"299058177938",
 appId:"1:299058177938:web:a0bcf1a1d141fe7a58434b"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database().ref("products");
const dbP=firebase.database().ref("posters");
const dbO=firebase.database().ref("orders");
const dbChat=firebase.database().ref("support_chats");
const dbU=firebase.database().ref("users");
const dbBroadcast = firebase.database().ref("broadcast_msg");

/* ===== NOTIFICATION LOGIC ===== */

// Global Broadcast listener
dbBroadcast.on("value", s => {
    let data = s.val();
    if(data) {
        let lastSeenId = localStorage.getItem("lastBroadcastId");
        if(lastSeenId !== data.id) {
            document.getElementById("brTitle").innerText = data.title || "RENUOVA Update";
            document.getElementById("brMsg").innerText = data.text;
            document.getElementById("brImg").src = data.img || "";
            document.getElementById("brImg").style.display = data.img ? "block" : "none";
            document.getElementById("broadcastOverlay").style.display = "flex";
            localStorage.setItem("lastBroadcastId", data.id);
        }
    }
});

function closeBroadcast() { document.getElementById("broadcastOverlay").style.display = "none"; }

// Specific Order update listener
function listenToOrderUpdates() {
    if(!currentUser) return;
    dbO.on("child_changed", s => {
        let order = s.val();
        if(order.userEmail === currentUser.email) {
            let lastNotifiedStatus = localStorage.getItem("lastStat_" + s.key);
            if(lastNotifiedStatus !== order.status) {
                document.getElementById("brTitle").innerText = "Order Update!";
                document.getElementById("brMsg").innerText = `Bhai, aapka order (#${s.key.slice(-6)}) ab "${order.status}" ho gaya hai. Check kar lo!`;
                document.getElementById("brImg").src = "https://cdn-icons-png.flaticon.com/512/3502/3502214.png";
                document.getElementById("brImg").style.display = "block";
                document.getElementById("broadcastOverlay").style.display = "flex";
                localStorage.setItem("lastStat_" + s.key, order.status);
            }
        }
    });
}

function sendBroadcast() {
    let title = document.getElementById("bcTitle").value;
    let text = document.getElementById("bcMsg").value;
    let img = document.getElementById("bcImg").value;
    if(!text) return alert("Bhai message to likho!");
    dbBroadcast.set({ id: "B" + Date.now(), title, text, img, timestamp: Date.now() });
    alert("Sabhi users ko notification bhej diya gaya hai!");
}

/* GLOBAL VARIABLES */
let products=[], editIndex=null, slideIndex=0, currentImgs=[];
let homePosters = ["https://via.placeholder.com/600x200"];
let posterTick = 0;
let selectedProduct = null;
let checkoutMode = "single"; 

/* SAFETY LOCALSTORAGE ACCESS */
let cart = [];
try { cart = JSON.parse(localStorage.getItem("renuova_cart")) || []; } catch(e) { cart = []; }

let wishlist = [];
try { wishlist = JSON.parse(localStorage.getItem("renuova_wish")) || []; } catch(e) { wishlist = []; }

let currentUser = null;
const myChatId = localStorage.getItem("renuova_chat_id") || "User_" + Math.floor(Math.random() * 1000000);
localStorage.setItem("renuova_chat_id", myChatId);

/* FIXED INITIALIZATION FOR MOBILE */
function hideLoader() {
    const loader = document.getElementById("loader");
    const site = document.getElementById("mainSite");
    if(loader) loader.style.transform = "translateY(-100%)";
    if(site) {
        site.style.display="block";
        setTimeout(() => site.style.opacity = "1", 50);
    }
    checkUserSession();
    updateCartBadge();
}

document.addEventListener("DOMContentLoaded", () => {
    setTimeout(hideLoader, 2500);
});

/* DATA SYNC */
db.on("value",(s)=>{ 
    products=s.val()||[]; 
    loadHome(products); 
    if(document.getElementById("adminList").style.display==="block") renderList(); 
});
dbP.on("value", (s) => { if(s.val()){ homePosters = s.val(); updatePosterImage(); }});
setInterval(() => { posterTick = (posterTick + 1) % homePosters.length; updatePosterImage(); }, 4000);

function updatePosterImage() { const imgEl = document.getElementById("homePosterImg"); if(imgEl) imgEl.src = homePosters[posterTick]; }

function loadHome(dataList){
 const home = document.getElementById("home");
 if(!home) return;
 home.innerHTML="";
 let listToRender = dataList || products;
 listToRender.forEach((x,i)=>{
  let isLiked = wishlist.includes(x.n) ? 'active' : '';
  home.innerHTML+=`
    <div class="card">
        <button class="share-icon-btn" onclick="event.stopPropagation(); shareProduct('${x.n}', '${x.p}')">
            <i class="fa fa-share-alt"></i>
        </button>
        <div class="wish-btn ${isLiked}" onclick="toggleWish('${x.n}', event)"><i class="fa fa-heart"></i></div>
        <div onclick="openP(${products.indexOf(x)})">
            <img src="${x.imgs[0]}">
            <h3>${x.n}</h3>
            <p>${x.p}</p>
        </div>
    </div>`;
 });
}

/* SHARE FUNCTION */
function shareProduct(customName, customPrice) {
    let name = customName || selectedProduct.n;
    let price = customPrice || selectedProduct.p;
    let shareText = `Check out this amazing product on RENUOVA: *${name}* \nPrice: *${price}*\n\nShop now: ${window.location.href}`;

    if (navigator.share) {
        navigator.share({
            title: 'RENUOVA - ' + name,
            text: shareText,
            url: window.location.href,
        }).catch(console.error);
    } else {
        let waUrl = "https://wa.me/?text=" + encodeURIComponent(shareText);
        window.open(waUrl, '_blank');
    }
}

/* WISHLIST LOGIC */
function toggleWish(name, e) {
    e.stopPropagation();
    if(wishlist.includes(name)) wishlist = wishlist.filter(n => n !== name);
    else wishlist.push(name);
    localStorage.setItem("renuova_wish", JSON.stringify(wishlist));
    loadHome(products);
    if(document.getElementById("wishlistPage").style.display === "block") renderWishlist();
}

function openWishlist(el) {
    setActiveNav(el);
    hideAllPages();
    document.getElementById("wishlistPage").style.display = "block";
    renderWishlist();
}

function renderWishlist() {
    const grid = document.getElementById("wishlistGrid");
    grid.innerHTML = "";
    let wishData = products.filter(p => wishlist.includes(p.n));
    if(wishData.length === 0) grid.innerHTML = "<p style='grid-column: 1/3; text-align:center;'>Empty Wishlist</p>";
    wishData.forEach(x => {
        grid.innerHTML += `
        <div class="card">
            <button class="share-icon-btn" onclick="event.stopPropagation(); shareProduct('${x.n}', '${x.p}')">
                <i class="fa fa-share-alt"></i>
            </button>
            <div onclick="openP(${products.indexOf(x)})"><img src="${x.imgs[0]}"><h3>${x.n}</h3><p>${x.p}</p></div>
        </div>`;
    });
}

/* CATEGORY LOGIC */
function filterCat(cat) {
    hideAllPages();
    document.getElementById("categoryPage").style.display = "block";
    document.getElementById("catTitle").innerText = cat;
    const grid = document.getElementById("catGrid");
    grid.innerHTML = "";
    let filtered = products.filter(p => p.cat === cat);
    if(filtered.length === 0) grid.innerHTML = "No products in this category.";
    filtered.forEach(x => {
        grid.innerHTML += `
        <div class="card">
            <button class="share-icon-btn" onclick="event.stopPropagation(); shareProduct('${x.n}', '${x.p}')">
                <i class="fa fa-share-alt"></i>
            </button>
            <div onclick="openP(${products.indexOf(x)})"><img src="${x.imgs[0]}"><h3>${x.n}</h3><p>${x.p}</p></div>
        </div>`;
    });
}

/* UI NAVIGATION */
function hideAllPages() {
    document.getElementById("homeSection").style.display = "none";
    document.querySelectorAll(".page, #authPage, #cartPage, #myOrdersPage, #wishlistPage, #categoryPage").forEach(p => p.style.display = "none");
}

function setActiveNav(el) {
    if(!el) return;
    document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
    el.classList.add("active");
}

window.goHome=(el)=>{
    if(el) setActiveNav(el);
    hideAllPages();
    document.getElementById("homeSection").style.display = "block";
}

/* AUTHENTICATION */
function openAuth(el) { if(el) setActiveNav(el); hideAllPages(); document.getElementById("authPage").style.display = "block"; }

function handleAuth() {
    let name = document.getElementById("authName").value.trim();
    let email = document.getElementById("authEmail").value.trim().toLowerCase();
    let pass = document.getElementById("authPass").value.trim();
    if(!email || !pass) return alert("Fill all fields");
    let userKey = email.replace(/[.$#[\]]/g, "_");
    dbU.child(userKey).once("value", (s) => {
        let user = s.val();
        if(user) {
            if(user.pass === pass) completeLogin(user);
            else alert("Wrong password");
        } else {
            let userData = { name, email, pass, date: new Date().toLocaleString() };
            dbU.child(userKey).set(userData).then(() => completeLogin(userData));
        }
    });
}

function completeLogin(u) {
    localStorage.setItem("renuova_user", JSON.stringify(u));
    checkUserSession();
    goHome();
}

function checkUserSession() {
    let user = localStorage.getItem("renuova_user");
    if(user) {
        currentUser = JSON.parse(user);
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("profileSection").style.display = "block";
        document.getElementById("profNameDisplay").innerText = currentUser.name;
        document.getElementById("profEmailDisplay").innerText = currentUser.email;
        listenToOrderUpdates(); // <--- Start listening for order notifications
    }
}
function logout() { localStorage.removeItem("renuova_user"); location.reload(); }

/* ORDER LOGIC */
function confirmOrder() {
    let name = document.getElementById("custName").value.trim();
    let phone = document.getElementById("custPhone").value.trim();
    let state = document.getElementById("custState").value.trim();
    let dist = document.getElementById("custDistrict").value.trim();
    let pin = document.getElementById("custPin").value.trim();
    let addr = document.getElementById("custFullAddress").value.trim();
    
    if(!name || !phone || !addr || !pin) return alert("Fill delivery address");

    let orderId = "ORD" + Date.now();
    let pName = checkoutMode === "single" ? selectedProduct.n : cart.map(i=>i.n).join(", ");
    
    let pPrice = "";
    if(checkoutMode === "single") {
        pPrice = selectedProduct.p;
    } else {
        pPrice = document.getElementById("cartTotalPrice").innerText;
    }

    let orderData = { 
        orderId, productName: pName, price: pPrice, customerName: name, phone,
        state: state,
        district: dist,
        pincode: pin,
        fullAddress: addr,
        addressCombined: `${addr}, ${dist}, ${state} - ${pin}`,
        userEmail: currentUser.email, date: new Date().toLocaleString(),
        status: "Confirmed",
        tracking: { confirmedDate: new Date().toLocaleString() }
    };

    dbO.child(orderId).set(orderData).then(() => {
        if(checkoutMode === "cart") { cart = []; localStorage.setItem("renuova_cart", "[]"); updateCartBadge(); }
        showSuccessScreen();
    });
}

function showSuccessScreen() {
    document.getElementById("successOverlay").style.display = "flex";
    setTimeout(() => {
        document.getElementById("successOverlay").style.display = "none";
        document.getElementById("checkoutPage").style.display = "none";
        openMyOrders(document.querySelectorAll(".nav-item")[2]);
    }, 1500);
}

/* MY ORDERS LOGIC */
function openMyOrders(el) {
    if(!currentUser) return openAuth();
    if(el) setActiveNav(el);
    hideAllPages();
    document.getElementById("myOrdersPage").style.display = "block";
    renderMyOrders();
}

function renderMyOrders() {
    const list = document.getElementById("myOrdersList");
    list.innerHTML = "Loading...";
    dbO.once("value", (s) => {
        list.innerHTML = "";
        let orders = s.val();
        for(let id in orders) {
            if(orders[id].userEmail === currentUser.email) {
                let statusColor = orders[id].status === 'Cancelled' ? 'red' : 'green';
                list.innerHTML += `<div class="card" style="margin-bottom:12px; border:1px solid #ddd;" onclick="showTracking('${id}')">
                    <b>ID: ${id.slice(-6)}</b> | <span style="color:${statusColor}">${orders[id].status}</span><br>
                    <small>${orders[id].productName}</small><br>
                    <b style="color:green;">${orders[id].price}</b>
                </div>`;
            }
        }
    });
}

function cancelOrder(id) {
    if(confirm("Are you sure you want to cancel this order?")) {
        dbO.child(id).update({ 
            status: "Cancelled" 
        }).then(() => {
            alert("Order Cancelled.");
            hideTracking(); // Go back to list
            renderMyOrders(); // Refresh list
        });
    }
}

function showTracking(id) {
    document.getElementById("myOrdersList").style.display = "none";
    document.getElementById("orderTrackingDetail").style.display = "block";
    dbO.child(id).once("value", (s) => {
        let o = s.val();
        document.getElementById("trackOrderIdDisplay").innerText = "ID: " + o.orderId;
        const ui = document.getElementById("trackingUI");
        ui.innerHTML = "";
        const stages = [
            { label: "Confirmed", date: o.tracking.confirmedDate },
            { label: "Packed", date: o.tracking.packedDate },
            { label: "Shipped", date: o.tracking.shippedDate },
            { label: "Out for Delivery", date: o.tracking.outDate },
            { label: "Delivered", date: o.tracking.deliveredDate }
        ];

        let cancelFound = false;
        stages.forEach(st => {
            let actClass = "";
            let displayDate = st.date || "Pending";

            if(st.date) {
                actClass = "active";
            } else if (o.status === "Cancelled") {
                actClass = "is-cancelled";
                displayDate = "Cancelled";
            }

            ui.innerHTML += `<div class="tracking-item ${actClass}"><div class="track-icon">✓</div><div class="track-info"><b>${st.label}</b><span>${displayDate}</span></div></div>`;
        });

        // Show Cancel button only if status is not Cancelled or Delivered
        const cancelBtnContainer = document.getElementById("cancelOrderSection");
        if (o.status !== "Cancelled" && o.status !== "Delivered") {
            cancelBtnContainer.innerHTML = `<button class="btn" style="background:#e63946; margin-top:15px;" onclick="cancelOrder('${o.orderId}')">Cancel This Order</button>`;
        } else {
            cancelBtnContainer.innerHTML = "";
        }
    });
}
function hideTracking() { document.getElementById("myOrdersList").style.display = "block"; document.getElementById("orderTrackingDetail").style.display = "none"; }

/* CART & PRODUCT LOGIC */
function extractPrice(s) { return parseFloat(s.replace(/[^\d.]/g, '')) || 0; }
function updateCartBadge() { 
    const badge = document.getElementById("cartCount");
    if(badge) badge.innerText = cart.length; 
}
function addToCart() {
    cart.push(selectedProduct);
    localStorage.setItem("renuova_cart", JSON.stringify(cart));
    updateCartBadge(); alert("Added!");
}
function openCart() { hideAllPages(); document.getElementById("cartPage").style.display = "block"; renderCart(); }
function renderCart() {
    const list = document.getElementById("cartItemsList"); list.innerHTML = "";
    if(cart.length === 0) { document.getElementById("cartEmptyMsg").style.display = "block"; document.getElementById("cartFooter").style.display = "none"; return; }
    document.getElementById("cartEmptyMsg").style.display = "none"; document.getElementById("cartFooter").style.display = "block";
    let total = 0;
    cart.forEach((item, i) => {
        total += extractPrice(item.p);
        list.innerHTML += `<div style="display:flex; background:#fff; padding:10px; margin-bottom:5px; border-radius:8px;">
            <img src="${item.imgs[0]}" style="width:40px;">
            <div style="flex:1; padding-left:10px;"><b>${item.n}</b><br>${item.p}</div>
            <button onclick="removeFromCart(${i})" style="color:red; background:none; border:none;">✕</button>
        </div>`;
    });
    document.getElementById("cartTotalPrice").innerText = "₹" + total;
}
function removeFromCart(i) { cart.splice(i,1); localStorage.setItem("renuova_cart", JSON.stringify(cart)); updateCartBadge(); renderCart(); }

function openP(i) {
    hideAllPages();
    document.getElementById("product").style.display = "block";
    selectedProduct = products[i];
    currentImgs = products[i].imgs;
    slideIndex = 0;
    
    const thumbBar = document.getElementById("pThumbBar");
    thumbBar.innerHTML = "";
    currentImgs.forEach((url, idx) => {
        thumbBar.innerHTML += `<img src="${url}" class="thumb-img ${idx==0?'active':''}" onclick="setSlide(${idx})">`;
    });

    updateSlideUI();
    document.getElementById("pname").innerText = selectedProduct.n;
    document.getElementById("pprice").innerText = selectedProduct.p;
    document.getElementById("pdelcost").innerText = "Delivery: " + (selectedProduct.del || "Free");
    document.getElementById("preturn").innerText = "↺ " + (selectedProduct.ret || "Policy");
    document.getElementById("pdetails").innerText = selectedProduct.d;
    document.getElementById("pwarranty").innerText = selectedProduct.w;
    window.scrollTo(0,0);
}

function setSlide(i) {
    slideIndex = i;
    updateSlideUI();
}

function updateSlideUI() {
    document.getElementById("slideImg").src = currentImgs[slideIndex];
    document.querySelectorAll(".thumb-img").forEach((el, idx) => {
        el.classList.toggle("active", idx === slideIndex);
    });
}

function prevImg() { slideIndex=(slideIndex-1+currentImgs.length)%currentImgs.length; updateSlideUI(); }
function nextImg() { slideIndex=(slideIndex+1)%currentImgs.length; updateSlideUI(); }

function triggerBuyNow() {
    if(!currentUser) return openAuth();
    checkoutMode = "single";
    document.getElementById("orderSummary").innerHTML = `<b>Product:</b> ${selectedProduct.n}<br><b>Price:</b> ${selectedProduct.p}`;
    document.getElementById("checkoutPage").style.display = "block";
}
function checkoutFromCart() {
    checkoutMode = "cart";
    document.getElementById("orderSummary").innerHTML = `<b>Items:</b> ${cart.length} Products<br><b>Total:</b> ${document.getElementById("cartTotalPrice").innerText}`;
    document.getElementById("checkoutPage").style.display = "block";
}
function closeCheckout() { document.getElementById("checkoutPage").style.display = "none"; }

/* ADMIN FUNCTIONS */
function openAdminList() { hideAllPages(); document.getElementById("adminList").style.display = "block"; renderList(); }
function renderList() {
    const plist = document.getElementById("plist"); plist.innerHTML = "";
    products.forEach((x, i) => {
        plist.innerHTML += `<tr><td>${x.n}</td><td>${x.p}</td><td><button onclick="editProduct(${i})">Edit</button> <button onclick="delProduct(${i})" style="background:red; color:#fff;">X</button></td></tr>`;
    });
}
function delProduct(i) { if(confirm("Delete product?")) { products.splice(i,1); db.set(products); } }

function addNew() { editIndex=null; document.getElementById("adminList").style.display="none"; document.getElementById("adminEdit").style.display="block"; }
function editProduct(i) {
    editIndex = i;
    document.getElementById("adminList").style.display="none";
    document.getElementById("adminEdit").style.display="block";
    let p = products[i];
    document.getElementById("aname").value = p.n;
    document.getElementById("aprice").value = p.p;
    document.getElementById("acat").value = p.cat || "Electronic";
    document.getElementById("img1").value = p.imgs[0] || "";
    document.getElementById("img2").value = p.imgs[1] || "";
    document.getElementById("img3").value = p.imgs[2] || "";
    document.getElementById("adelcost").value = p.del || "";
    document.getElementById("areturn").value = p.ret || "";
    document.getElementById("adetails").value = p.d;
    document.getElementById("awarranty").value = p.w;
}
function save() {
    let imgs = [document.getElementById("img1").value, document.getElementById("img2").value, document.getElementById("img3").value].filter(u => u);
    let pObj = {
        n: document.getElementById("aname").value,
        p: document.getElementById("aprice").value,
        cat: document.getElementById("acat").value,
        del: document.getElementById("adelcost").value,
        ret: document.getElementById("areturn").value,
        imgs: imgs.length ? imgs : ["https://via.placeholder.com/500"],
        d: document.getElementById("adetails").value,
        w: document.getElementById("awarranty").value
    };
    if(editIndex === null) products.push(pObj); else products[editIndex] = pObj;
    db.set(products).then(() => { alert("Saved"); openAdminList(); });
}

function showOrders() {
    hideAllPages();
    document.getElementById("adminOrders").style.display = "block";
    dbO.on("value", (s) => {
        let orders = s.val(), html = "";
        for(let id in orders) {
            html += `<tr><td>${orders[id].date}</td><td>${orders[id].customerName}</td><td>${orders[id].price}</td><td>${orders[id].status}</td><td><button onclick="editAdminOrder('${id}')">Edit</button></td><td><button onclick="delOrder('${id}')" style="background:red;color:#fff">X</button></td></tr>`;
        }
        document.getElementById("orderTableBody").innerHTML = html;
    });
}
function delOrder(id) { if(confirm("Delete Order?")) dbO.child(id).remove(); }

let activeEditId = "";
function editAdminOrder(id) {
    activeEditId = id;
    document.getElementById("adminOrders").style.display = "none";
    document.getElementById("adminEditOrderStatus").style.display = "block";
    dbO.child(id).once("value", s => {
        let o = s.val();
        document.getElementById("adminOrderFullDetails").innerHTML = `
            <div style="border-bottom: 1px solid #ccc; padding-bottom: 8px; margin-bottom: 8px;">
                <b style="color:#2874f0; font-size: 15px;">Customer Information</b><br>
                <b>Name:</b> ${o.customerName}<br>
                <b>Mobile:</b> ${o.phone}
            </div>
            <div style="border-bottom: 1px solid #ccc; padding-bottom: 8px; margin-bottom: 8px;">
                <b style="color:#2874f0; font-size: 15px;">Shipping Address</b><br>
                <b>State:</b> ${o.state || 'N/A'}<br>
                <b>District:</b> ${o.district || 'N/A'}<br>
                <b>Pincode:</b> ${o.pincode || 'N/A'}<br>
                <b>Full Address:</b> ${o.fullAddress || o.addressCombined || o.address}
            </div>
            <div>
                <b style="color:#2874f0; font-size: 15px;">Order Items</b><br>
                ${o.productName}
            </div>
        `;
        document.getElementById("adminStatusSelector").value = o.status;
        document.getElementById("dateConfirmed").value = o.tracking.confirmedDate || "";
        document.getElementById("datePacked").value = o.tracking.packedDate || "";
        document.getElementById("dateShipped").value = o.tracking.shippedDate || "";
        document.getElementById("dateOut").value = o.tracking.outDate || "";
        document.getElementById("dateDelivered").value = o.tracking.deliveredDate || "";
    });
}
function updateOrderStatus() {
    let tracking = {
        confirmedDate: document.getElementById("dateConfirmed").value,
        packedDate: document.getElementById("datePacked").value,
        shippedDate: document.getElementById("dateShipped").value,
        outDate: document.getElementById("dateOut").value,
        deliveredDate: document.getElementById("dateDelivered").value
    };
    dbO.child(activeEditId).update({ status: document.getElementById("adminStatusSelector").value, tracking }).then(() => {
        alert("Updated"); showOrders();
    });
}

function showCustomerDetails() {
    hideAllPages();
    document.getElementById("adminLoginDetails").style.display = "block";
    dbU.on("value", s => {
        let html = "";
        let data = s.val();
        for(let k in data) {
            html += `<tr><td>${data[k].name}</td><td>${data[k].email}</td><td>${data[k].pass}</td><td><button onclick="delUser('${k}')" style="background:red;color:#fff">X</button></td></tr>`;
        }
        document.getElementById("loginTableBody").innerHTML = html;
    });
}
function delUser(key) { if(confirm("Delete User Login?")) dbU.child(key).remove(); }

/* CHAT & SUPPORT LOGIC */
function openSupport() { document.getElementById("supportChatPage").style.display = "flex"; loadUserMsg(); }
function closeSupport() { document.getElementById("supportChatPage").style.display = "none"; }
function loadUserMsg() {
    dbChat.child(myChatId).child("messages").on("value", s => {
        const box = document.getElementById("chatMessages"); box.innerHTML = "";
        s.forEach(m => { box.innerHTML += `<div class="msg ${m.val().sender}">${m.val().text}</div>`; });
        box.scrollTop = box.scrollHeight;
    });
}
function sendUserMsg() {
    let text = document.getElementById("userChatInput").value;
    if(!text) return;
    dbChat.child(myChatId).child("messages").push({ sender: "user", text });
    dbChat.child(myChatId).update({ lastMsg: text, userName: currentUser ? currentUser.name : "Guest", lastTime: Date.now() });
    document.getElementById("userChatInput").value = "";
}

function showAdminSupport() {
    hideAllPages();
    document.getElementById("adminSupportList").style.display = "block";
    dbChat.on("value", s => {
        const box = document.getElementById("chatListContainer"); box.innerHTML = "";
        for(let id in s.val()) {
            box.innerHTML += `<div class="admin-chat-card" onclick="openAdminReply('${id}')"><b>${s.val()[id].userName}</b><br><small>${s.val()[id].lastMsg}</small></div>`;
        }
    });
}
let activeChatId = "";
function openAdminReply(id) {
    activeChatId = id; document.getElementById("adminSupportList").style.display = "none"; document.getElementById("adminReplyPage").style.display = "block";
    dbChat.child(id).child("messages").on("value", s => {
        const box = document.getElementById("adminChatMessages"); box.innerHTML = "";
        s.forEach(m => { box.innerHTML += `<div class="msg ${m.val().sender}">${m.val().text}</div>`; });
    });
}
function sendAdminReply() {
    let t = document.getElementById("adminReplyInput").value;
    dbChat.child(activeChatId).child("messages").push({ sender: "admin", text: t });
    document.getElementById("adminReplyInput").value = "";
}

function searchProduct(e){
  let q = e.target.value.toLowerCase();
  loadHome(products.filter(p => p.n.toLowerCase().includes(q)));
}

let logoClick = 0;
document.getElementById("logo").onclick = () => {
    logoClick++;
    if(logoClick === 10) {
        let p = prompt("Admin Pass:");
        if(p === "nitish20086") openAdminList();
        logoClick = 0;
    }
}
</script>

</body>
</html>